# VisLOL 项目需求文档

## 0. 文档说明

本文档定义 VisLOL 项目的前端展示与交互需求（PRD），覆盖三个核心模块：

1. 游戏生态模块（Game Ecosystem）
2. 玩家模块（Player / LoL API，可选）
3. 电竞赛事模块（Esports）

**共同约束：**

- 不做任何机器学习预测/推荐
- 数据更新采用“用户手动触发更新”模式
- 页面需显示数据更新时间、更新状态与失败提示

------

## 1. 游戏生态模块需求文档（Game Ecosystem Module PRD）

### 1.1 模块概述

#### 1.1.1 模块目标

游戏生态模块用于展示《英雄联盟》**游戏本体层面的静态与版本化信息**，帮助用户理解：

- 当前与历史游戏版本的基本情况
- 英雄的基础属性、定位与成长特性
- 装备的属性、价格与合成体系

本模块**不涉及胜率预测、环境强度评估等机器学习内容**，仅提供**描述性、结构化、可交互的可视化分析**。

#### 1.1.2 模块结构

游戏生态模块由 **3 个 Tab 页面** 组成：

| Tab   | 名称             | 核心数据源                                                                 |
| ----- | ---------------- | -------------------------------------------------------------------------- |
| Tab 1 | 版本（Patch）    | Data Dragon：本地版本目录 `data/raw/ddragon/*` + `realms_{region}.json`    |
| Tab 2 | 英雄（Champion） | Data Dragon：`champion.json`（摘要；技能详情需额外 `champion/{champion}.json`） |
| Tab 3 | 装备（Item）     | Data Dragon：`item.json`                                                   |

------

### 1.2 数据依赖说明（前置条件）

#### 1.2.1 数据来源

本模块**仅依赖 Data Dragon 数据**，不依赖 Riot API Key。

使用的数据文件包括：

- `realms_{region}.json`
- `champion.json`
- `item.json`
- `summoner.json`
- `runesReforged.json`

数据存储路径：

```

data/raw/ddragon/{version}/{locale}/
```

#### 1.2.2 数据使用原则

- 所有可视化基于 **某一指定版本**
  - 默认使用 `realms_{region}.json` 或 `data/meta/ddragon_state.json` 中记录的版本
- 历史版本仅用于：
  - 版本列表展示
  - 版本选择（不做复杂跨版本对比）

#### 1.2.3 更新与状态

- 更新入口：`python -m pipeline ddragon`
- 页面需显示：
  - 当前数据版本（selected version）
  - 最近一次更新成功时间（建议读 `data/meta/ddragon_state.json` 或文件 mtime）
  - 更新失败提示（若有 logs，可给出提示路径）

------

### 1.3 Tab 1：版本模块（Patch Tab）

#### 1.3.1 功能目标

展示当前项目支持的《英雄联盟》版本信息，并明确指出**当前客户端版本**。

#### 1.3.2 功能需求

**功能 1：版本列表展示**

- 展示本地 `data/raw/ddragon/` 目录下可用版本（按时间倒序）
- 支持搜索/快速定位版本（可选增强）
- 若本地仅有单一版本，可简化为只读展示

**功能 2：当前版本标识**

- 读取 `realms_{region}.json` 中的 `v`（若存在）
- 在版本列表中高亮当前版本
- 页面顶部展示 “当前版本：xx.xx.x”

#### 1.3.3 可视化与组件要求

| 元素         | 类型                     |
| ------------ | ------------------------ |
| 当前版本卡片 | Text / Badge             |
| 版本列表     | DataTable 或 List        |
| 版本选择     | 单选（Radio / Dropdown） |

#### 1.3.4 交互逻辑

- 用户选择某一版本 → 后续 Tab（英雄 / 装备）**使用该版本的数据**
- 当前版本始终作为默认选中项

#### 1.3.5 数据字段需求

- `data/raw/ddragon/*` 目录名（版本号）
- `data/meta/ddragon_state.json.last_version_downloaded`
- `realms_{region}.json.v`（若存在）

------

### 1.4 Tab 2：英雄模块（Champion Tab）

> 本模块是游戏生态部分的**核心展示页面**。

#### 1.4.1 功能目标

支持对英雄进行：

- 全局属性分布探索
- 单英雄详情查看
- 英雄成长曲线分析（1–18 级）

------

#### 1.4.2 功能一：英雄总览散点图（多维属性）

**功能描述**
 通过散点图展示所有英雄的基础属性分布，用于探索不同英雄类型之间的差异。

**可视化设计：散点图（Scatter Plot）**

| 维度   | 含义                                          |
| ------ | --------------------------------------------- |
| X 轴   | 基础攻击力（`stats.attackdamage`）            |
| Y 轴   | 基础生命值（`stats.hp`）                      |
| 点大小 | 移速（`stats.movespeed`）                     |
| 点颜色 | 英雄标签（`tags`，如 Mage / Tank / Assassin） |

**交互需求**

- Hover：显示英雄名称 + 关键属性
- 点击点：选中该英雄并联动更新“英雄详情面板”

**数据字段需求**

- 来自 `champion.json`：
  - `id`, `name`
  - `tags`
  - `stats.attackdamage`, `stats.hp`, `stats.movespeed`

------

#### 1.4.3 功能二：英雄详情展示

**功能描述**
 展示单个英雄的基础信息与属性概览。

**展示内容**

- 英雄名称、称号
- 英雄定位（tags）
- 英雄技能列表（被动 / Q / W / E / R）仅在存在 `champion/{champion}.json` 时展示
- 英雄基础属性表

**数据字段需求**

- 来自 `champion.json`：
  - `name`, `title`
  - `tags`
  - `blurb`
  - `stats`

------

#### 1.4.4 功能三：英雄成长曲线（1–18 级）

**功能描述**
 展示英雄在 1–18 级过程中的属性成长趋势。

**可视化设计：折线图（Line Chart）**

- X 轴：等级（1–18）
- Y 轴（可切换）：生命值 / 攻击力 / 护甲 / 魔抗

**计算逻辑**

```

属性(level) = base + (level - 1) * perLevel
```

**交互需求**

- 下拉选择属性类型
- 切换英雄 → 曲线自动更新
- （后续扩展）多英雄对比

------

### 1.5 Tab 3：装备模块（Item Tab）

#### 1.5.1 功能目标

支持用户：

- 理解装备属性与价格分布
- 探索装备合成关系

------

#### 1.5.2 功能一：装备价格-属性散点图

**功能描述**
 展示装备价格与属性之间的关系，用于理解装备性价比和分类。

**可视化设计：散点图（Scatter Plot）**

| 维度   | 含义                                  |
| ------ | ------------------------------------- |
| X 轴   | 装备总价格（`gold.total`）            |
| Y 轴   | 选定属性值（攻击力 / 法强 / 护甲 等） |
| 点颜色 | 装备类别（`tags`）                    |

**交互需求**

- 下拉选择属性维度（攻击力 / 法强 / 护甲）
- 标签筛选（checkbox，多选 tags）
- Hover 显示装备名称与完整属性
- 点击装备 → 联动显示合成路线

**数据字段需求**

- 来自 `item.json`：
  - `name`
  - `gold.total`
  - `stats`
  - `tags`

------

#### 1.5.3 功能二：装备合成路线展示（from / into）

**功能描述**
 展示某一装备的合成结构，包括：

- 由哪些组件合成
- 可以合成到哪些高阶装备

**可视化设计：结构化关系展示（非复杂图网络）**
 三栏结构：

```

[组件装备] → [当前装备] → [可升级装备]
```

**交互需求**

- 点击组件 / 升级装备 → 跳转到该装备详情（同 Tab 内钻取）
- 合成结构随装备选择实时更新

**数据字段需求**

- 来自 `item.json`：
  - `from`（组件 ID 列表）
  - `into`（升级 ID 列表）

------

### 1.6 跨 Tab 联动规则

- 当前选中版本在三个 Tab 间共享
- 英雄/装备点击行为只影响当前 Tab
- 不做跨模块复杂联动（保持结构清晰）

------

### 1.7 非目标与约束

- 不做英雄/装备强度评估
- 不做胜率/环境分析
- 不引入机器学习模型
- 不强制要求 Riot API Key

------

### 1.8 阶段性交付目标

**第一阶段（最低可交付）**

- 版本列表 + 当前版本显示
- 英雄散点图 + 单英雄详情
- 装备散点图 + 合成关系展示

**第二阶段（增强体验）**

- 英雄成长曲线
- 多属性切换
- 更友好的 hover / tooltip

------

## 2. 玩家模块需求文档（Player Module PRD）

### 2.1 模块概述

#### 2.1.1 模块目标

玩家模块用于展示单个玩家的 **个人画像、英雄池、成就画像与最近对局表现**，支持用户按需触发更新数据并在前端进行交互式探索。

#### 2.1.2 数据范围与约束

- 数据来源：本地缓存 `data/raw/lolapi/`
- 更新方式：用户输入 Riot ID 后点击“更新玩家数据”
- 约束：Riot API Key 的有效期与速率限制 → 仅支持**手动更新**，并显示更新时间与失败提示

------

### 2.2 数据依赖（落地路径）

**玩家基础数据**

- `data/raw/lolapi/players/{puuid}/account.json`
- `data/raw/lolapi/players/{puuid}/summoner.json`
- `data/raw/lolapi/players/{puuid}/ranked.json`（可选）

**英雄熟练度**

- `data/raw/lolapi/players/{puuid}/mastery.json`

**成就挑战**

- `data/raw/lolapi/players/{puuid}/challenges.json`

**对局数据**

- `data/raw/lolapi/matches/{region}/{matchId}.json`
- `data/raw/lolapi/matches/{region}/timeline/{matchId}.json`（可选）

> 当前数据目录仅包含 timeline 文件，若缺少 match 详情文件，则“最近对局”中的英雄/KDA/位置需降级或提示重新抓取。

------

### 2.3 页面结构（建议 4 个子 Tab）

#### 2.3.1 Tab A：玩家概览（Profile）

**功能点**

1. 展示 Riot ID、puuid、召唤师等级、头像
2. 展示段位信息（若 ranked.json 存在）
3. 展示数据更新时间（`data/meta/lolapi_state.json` 或文件 mtime）

**组件与可视化**

- KPI 卡片：等级 / 段位 / LP / 胜率 / 总场次
- 基础信息表格（DataTable）

**交互**

- 输入框：Riot ID（或本地玩家下拉选择）
- 按钮：更新该玩家数据（触发 pipeline）
- 下拉：队列选择（Solo/Flex，如数据可用）
  - 当前数据目录仅有单个玩家时，默认下拉选择本地玩家

**异常处理**

- ranked.json 不存在 → 显示“排位数据不可用或未拉取”
- 更新失败 → 显示错误提示，并给出日志提示（如 `data/logs/lolapi.log`）

------

#### 2.3.2 Tab B：英雄池（Champion Pool）

**功能点**

1. Top N 英雄熟练度榜
2. 熟练度分布（长尾）
    3.（可选加分）英雄标签分布（与 Data Dragon tags join）

**组件与可视化**

- Top N 条形图（champion points）
- 直方图/箱线图（熟练度点数分布）
- 标签分布条形图（Mage/Assassin…）

**交互**

- N 选择：Top 10/20/50
- 排序切换：points / lastPlayTime / masteryLevel
- 点击英雄 → 联动 Tab D 的“英雄过滤条件”

**数据需求**

- mastery.json（必须）
- Data Dragon champion.json（可选联动）

------

#### 2.3.3 Tab C：Challenges（成就画像）

**功能点**

1. 挑战总体概览
2. 按类别筛选挑战
3. 能力画像（雷达图）

**组件与可视化**

- 雷达图：选 6–10 个挑战维度
- 分类条形图：不同类别分数汇总
- DataTable：挑战名称、等级、分数、进度

**交互**

- 类别筛选 dropdown
- 雷达维度多选
- 点击挑战 → 右侧详情面板（描述/进度）

**异常处理**

- challenges.json 缺失 → 显示“未获取挑战数据”

------

#### 2.3.4 Tab D：最近对局（Match History）

**功能点**

1. 最近 N 场列表（胜负、英雄、KDA、时长、位置）
2. 趋势图：KDA/伤害/经济/补刀随对局序列变化
3. 聚合统计：按英雄/位置胜率与表现
4. 单局详情钻取（可选 timeline）
   - 若仅有 timeline 数据，则只展示时间线指标与事件统计

**组件与可视化**

- 对局列表 DataTable（可点击行）
- 胜负序列条带图（W/L）
- 折线图：KDA、Gold、Damage、CS（指标可切换）
- 散点图：伤害 vs 经济（按胜负着色）
- 单局详情面板：KPI + objectives 对比 + 装备格

**交互**

- N 选择：最近 10/20/50
- 队列过滤（queueId）
- 位置过滤（teamPosition）
- 点击某局 → 展示单局详情
- timeline 开关：
  - 有 timeline 文件 → 显示经济差曲线/事件轴
  - 无 timeline 文件 → 提示“该局未下载 timeline”

**异常处理**

- match 文件缺失/解析失败：跳过并提示“部分对局数据缺失”
- 仅有 timeline 文件：显示时间线相关指标，其余字段提示“需要 match 详情文件”
- API 更新失败：保留旧数据，提示失败原因

------

### 2.4 全局交互与状态

**更新机制**

- 按钮：更新玩家数据
- 行为：
  1. 执行 lolapi pipeline（针对该玩家）
  2. 更新 `data/meta/lolapi_state.json`
  3. 前端刷新并提示成功/失败

**进度与日志**

- 展示最近一次更新的时间、是否成功
- 失败时提示日志位置（如 `data/logs/lolapi.log`）

------

### 2.5 非目标

- 不做任何预测/推荐
- 不做全服大规模抓取（仅个人/小范围）
- 不要求实时刷新（仅手动更新）

------

### 2.6 MVP

1. 玩家概览
2. 英雄池 Top N
3. 最近对局列表 + 单指标趋势
4. Challenges 雷达图（可选但加分）

------

## 3. 电竞赛事模块需求文档（Esports Module PRD）

### 3.1 模块概述

#### 3.1.1 模块目标

电竞赛事模块用于对《英雄联盟》**职业赛事数据进行结构化、交互式的可视化分析**，帮助用户从宏观到微观理解：

- 不同赛区、赛季的整体格局
- 战队与选手的长期表现特征
- 英雄与 BP 在职业赛场的使用趋势
- 单场比赛的关键结果与数据结构（非逐秒）

#### 3.1.2 数据来源与定位

| 数据源        | 角色                                    |
| ------------- | --------------------------------------- |
| esports_gw    | 赛事结构、赛程、Event/BO 导航、对阵信息 |
| oracle_elixir | 核心统计数据（比赛/选手/战队/BP）       |

说明：

- 本模块的分析主数据来自 **Oracle’s Elixir**
- esports_gw 用于 **赛事结构导航与对照（赛程/对阵/事件）**
- 当前 `data/raw/esports_gw/` 仅覆盖配置的赛区与时间窗口（本地为 LPL/LCK + 近 180 天）
  - Oracle 数据包含全量年份与赛区，需避免与 esports_gw 直接做 “ID 级” 联合

#### 3.1.3 更新与状态

- 更新入口：
  - `python -m pipeline esports`
  - `python -m pipeline oracle`
- 页面需显示：
  - oracle 数据年份覆盖范围（例如 2014–2025）
  - 最近一次更新成功时间（`oracle_elixir_state.json` / `esports_state.json` 或 mtime）
  - 更新失败提示（若有 logs，可给出提示路径）

------

### 3.2 模块结构（4 个 Tab + 钻取页）

| 子模块 | 名称      | 核心问题                  |
| ------ | --------- | ------------------------- |
| Tab 1  | 赛事总览  | 各赛区/赛季整体情况如何？ |
| Tab 2  | 战队分析  | 战队成绩与风格如何？      |
| Tab 3  | 选手分析  | 选手表现与位置差异如何？  |
| Tab 4  | 英雄与 BP | 职业赛场英雄趋势如何？    |

- “单场比赛回顾”作为钻取页面，不单独占一个 Tab。

------

### 3.3 Tab 1：赛事总览（League & Season Overview）

#### 3.3.1 功能目标

- 各赛区赛事规模
- 不同赛季的比赛数量、胜负情况
- 赛区风格差异

#### 3.3.2 可视化分析

- 柱状图：赛区 → 比赛场次
- 折线图：赛区 → 年度比赛数量变化
- 箱线图：赛区 → 比赛时长分布
- 气泡图：
  - X：平均比赛时长
  - Y：平均总击杀（聚合）
  - 点大小：比赛数量
  - 颜色：赛区

#### 3.3.3 交互需求

- 全局筛选：赛区 / 年份 / Split
- Hover 查看数值
- 点击赛区 → 联动跳转到战队分析 Tab（带过滤条件）

#### 3.3.4 数据字段需求（Oracle）

- `league`, `year`, `split`
- `gamelength`
- `kills`（聚合）
- `gameid`
- 统计比赛级指标时需过滤 `position = team`，避免重复计数

------

### 3.4 Tab 2：战队分析（Team Analysis）

#### 3.4.1 功能目标

分析战队在不同赛季/赛区下的成绩、风格与稳定性。

#### 3.4.2 可视化分析

- 柱状图：战队胜场/败场
- DataTable：胜率排行
- 雷达图（战队平均）：DPM / 经济(earned gpm) / Vision / damage share / KDA(派生)
- 散点图：经济(earned gpm) vs DPM（资源型/打架型区分）
- 折线图：赛季内胜率变化（可选增强）
- 箱线图：比赛时长/经济差分布（可选增强）

#### 3.4.3 交互需求

- 赛区 / 年份 / Split 筛选
- 多选 1–3 支战队对比
- 点击战队 → 联动选手分析 Tab

#### 3.4.4 数据字段需求（Oracle）

- `teamname`, `teamid`
- `result`
- `gamelength`
- `earned gpm`, `dpm`, `visionscore`, `damageshare`
- `kills`, `deaths`, `assists`, `teamkills`, `teamdeaths`（用于派生 KDA/KP）

------

### 3.5 Tab 3：选手分析（Player Analysis）

#### 3.5.1 功能目标

分析职业选手在不同位置、赛区中的表现差异与对比。

#### 3.5.2 可视化分析

- DataTable：选手排行榜（KDA / DPM / 经济(earned gpm) / 参团率(KP)）
- 箱线图：位置对比（DPM/经济(earned gpm)/KP 分布）
- 雷达图：同位置多名选手能力对比
- 折线图：选手随比赛序列的表现变化（可选增强）
- 散点图：伤害 vs 经济（按胜负着色，可选增强）

#### 3.5.3 交互需求

- 全局筛选：赛区 / 年份 / Split
- 位置筛选：TOP/JNG/MID/BOT/SUP
- 搜索选手名
- 多选选手对比
- 点击选手 → 联动英雄与 BP Tab（显示常用英雄 Top N）

#### 3.5.4 数据字段需求（Oracle）

- `playername`, `playerid`
- `position`
- `kills`, `deaths`, `assists`
- `dpm`, `visionscore`, `earned gpm`
- `teamkills`, `teamdeaths`（用于派生 KDA/KP）

------

### 3.6 Tab 4：英雄与 BP 分析（Meta & Draft）

#### 3.6.1 功能目标

分析职业赛场的英雄选择与禁用趋势，并提供跨赛区/跨赛季对比能力。

#### 3.6.2 可视化分析

- 柱状图：英雄 Pick Top N
- 折线图：某英雄跨赛季 Pick 变化
- 热力图：英雄 × 赛区 的 Pick/Ban 强度
- 条形图：蓝方/红方 Pick 差异
- 散点图：Pick 次数 vs 胜率（热门/效果）

#### 3.6.3 交互需求

- 全局筛选：赛区 / 年份 / Split
- Pick / Ban 切换
- 英雄搜索
- 点击英雄 → 跳转到“游戏生态模块-英雄详情”（跨模块联动）

#### 3.6.4 数据字段需求（Oracle）

- `champion`
- `ban1`~`ban5`, `pick1`~`pick5`
- `result`
- `league`, `year`, `split`

------

### 3.7 单场比赛回顾（钻取页面）

#### 3.7.1 功能目标

对某一场比赛进行**非逐秒、结构化回顾**。

#### 3.7.2 展示内容

- 比赛基本信息：赛区、日期、版本、对阵双方（优先 oracle；gw 仅作可选补充）
- 两队关键指标对比（击杀、目标、经济等）
- BP 列表
- 10 名选手数据表（可排序）

#### 3.7.3 数据来源

- oracle_elixir：单场筛选（gameid / date / teamname / playername 等）
- esports_gw：仅用于赛程导航；若需关联，需要按日期/战队名做弱匹配

------

### 3.8 非目标

- 不做实时比赛展示
- 不做逐秒时间线
- 不做预测、模型、强度评分
- 不展示数据抓取逻辑（已在 pipeline 完成）

------

### 3.9 MVP

1. 赛区比赛数量 + 比赛时长分布
2. 战队胜率排行 + 战队雷达图
3. 选手排行榜 + 位置箱线图
4. 英雄 Pick Top N + BP 热力图
